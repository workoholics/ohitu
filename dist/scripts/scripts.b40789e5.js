"use strict";angular.module("appOhituApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.router","ionic"]).config(["$routeProvider","$httpProvider",function(a,b){b.defaults.useXDomain=!0,b.defaults.withCredentials=!0,b.interceptors.push(["$q",function(a){var b=0;return{request:function(c){b++;var d=document.getElementsByClassName("loader");return d.length>0&&(d[0].style.display="inherit"),c||a.when(c)},response:function(c){if(0===--b){var d=document.getElementsByClassName("loader");d.length>0&&(d[0].style.display="none")}return c||a.when(c)},responseError:function(c){if(!--b){var d=document.getElementsByClassName("loader");d.length>0&&(d[0].style.display="none")}return a.reject(c)}}}]),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}],function(a){a.resourceUrlWhitelist([".*"])}),angular.module("appOhituApp").controller("LoginController",["$scope","$location","Utils","appMap","restclient",function(a,b,c,d,e){var f=function(b){401===b.status?a.loginValidationMessage=a.literals.wrong_pass_usr.literal:417===b.status?a.loginValidationMessage=a.literals.wrong_pass_usr.literal:0===b.status&&a.redirectOffline()},g=function(){console.log("ERROR RESTCLIENTE"),a.newUserValidationMessage=a.literals.user_exist.literal},h=function(b){a.contentManager.show(b.content.collection.length>0?a.appMap.challenge:a.appMap.firstUseSlider)};a.loginValidationMessage=null,a.newUserValidationMessage=null,a.forgotValidationMessage=null,a.login={user:"",password:"","do":function(){-1!==this.user.indexOf("@")?e.login.save({email:this.user,password:this.password},function(b){c.createSession(b.content.item),a.getChallenges(h)},f):e.login.save({username:this.user,password:this.password},function(b){c.createSession(b.content.item),a.getChallenges(h)},f)},reset:function(){this.user="",this.password=""}},a.newUser={email:"",user:"",pass:"",rptPass:"",create:function(){var b=this.user,d=this.pass;this.isValid()&&e.users.save({user:this.user,email:this.email,password:this.pass},function(){e.login.save({username:b,password:d},function(b){c.createSession(b.content.item),a.contentManager.show(a.appMap.firstUseSlider)},f)},g)},isValid:function(){var b=!1;if(""!==this.email&&""!==this.user&&this.pass&&this.rptPass){var c=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(c.test(this.email))if(this.user.length>=4&&this.user.length<=60)if(this.pass.length>=4){if(this.pass===this.rptPass)return!0;a.newUserValidationMessage=a.literals.diff_pass_error.literal}else a.newUserValidationMessage=a.literals.length_pass_error.literal;else a.newUserValidationMessage=a.literals.length_user_error.literal;else a.newUserValidationMessage=a.literals.wrong_mail_error.literal}else a.newUserValidationMessage=a.literals.empty_input_error.literal;return b},reset:function(){this.email="",this.user="",this.pass="",this.rptPass=""}},a.forgotPassword={email:"",send:function(){this.isValid()?e.resetpassword.send({email:this.email},function(){a.change(a.appMap.emailSent)},function(b){console.log("ERROR RESETEANDO CONTRASEÑA",b),a.forgotValidationMessage=a.literals.wrong_mail.literal}):a.forgotValidationMessage=a.literals.wrong_mail.literal},isValid:function(){var a=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,b=!1;return a.test(this.email)&&(b=!0),b},reset:function(){this.email=""}},a.resetInputs=function(){a.login.reset(),a.newUser.reset(),a.forgotPassword.reset()}}]),angular.module("appOhituApp").controller("MainCtrl",["$scope","$route","Utils","appMap","restclient","fixedLiterals",function(a,b,c,d,e,f){a.getLiterals=function(d){e.literals.get({screenId:d.id},function(b){var c=b.content.collection;a.literals={};for(var d=0;d<c.length;d++){var e=c.filter(function(a){return a.name===c[d].name});a.literals[c[d].name]=e[0]}},function(d){console.log("ERROR OBTENIENDO LITERALES",d),401===d.status?c.relogin(function(){b.reload()},a.redirectToLogin):0===d.status&&a.redirectOffline()})},a.getScreen=function(d,f){e.screens.get({name:d},f,function(d){console.log("ERROR GETTING SCREEN",d),401===d.status?c.relogin(function(){b.reload()},a.redirectToLogin):0===d.status&&a.redirectOffline()})},a.getScreenData=function(b){a.getScreen(b,function(b){a.screen=b.content.collection[0],a.getLiterals(a.screen)})},a.change=function(b,c){"object"==typeof b?(a.contentManager.change(b),a.getScreenData(b.subviewActive)):(a.contentManager.change(d[b]),a.getScreenData(b)),null!==c&&void 0!==c&&c()},a.redirectToLogin=function(){c.deleteSession(),a.contentManager.show(a.appMap.login)},a.reloadWithSession=function(a){c.createSession(a.content.item),b.reload()},a.getChallenges=function(b){e.challenges.get({},b,function(b){console.log("ERROR OBTENIENDO RETOS",b),401===b.status?c.relogin(a.reloadWithSession,a.redirectToLogin):0===b.status&&a.redirectOffline()})},a.logout=function(){e.login["delete"]({},function(){a.emptyChallengeCollection(),c.deleteSession(),a.contentManager.show(a.appMap.login)},function(b){console.log("ERROR OBTENIENDO RETOS",b),401===b.status?c.relogin(a.reloadWithSession,a.redirectToLogin):0===b.status&&a.redirectOffline()})},a.emptyChallengeCollection=function(){a.challengeCollection={}},a.redirectOffline=function(){a.online=!1,a.contentManager.show(a.appMap.login)},a.reload=function(){b.reload()},a.online=!0,a.appMap=d,a.fixedLiterals=f.eu,a.contentManager=c.getContentManager(c.sessionExist()?d.challenge:d.login),a.getScreen("menu",function(d){var f=d.content.collection[0];e.literals.get({screenId:f.id},function(b){var c=b.content.collection;a.menuLiterals={};for(var d=0;d<c.length;d++){var e=c.filter(function(a){return a.name===c[d].name});a.menuLiterals[c[d].name]=e[0]}},function(d){console.log("ERROR AL OBTENER LITERALES DEL MENÚ",d),401===d.status?c.relogin(function(){b.reload()},a.redirectToLogin):0===d.status&&a.redirectOffline()})})}]),angular.module("appOhituApp").controller("ChallengeNewCtrl",["$scope","$route","Utils","restclient",function(a,b,c,d){var e=function(){d.categories.get({},function(a){for(var b=a.content.collection,c=0;c<b.length;c++)f(b[c])},function(d){console.log("ERROR AL OBTENER CATEGORIAS",d),401===d.status?c.relogin(function(){b.reload()},a.redirectToLogin):0===d.status&&a.redirectOffline()})},f=function(e){d.recomendations.get({screenId:a.screen.id,categoryId:e.id},function(b){if(b.content.collection.length>0){var c={category:{id:e.id,name:e.name},items:b.content.collection};a.targetRecomendations.push(c)}},function(d){console.log("ERROR OBTENIENDO RECOMENDACIONES POR CATEGORIA",d),401===d.status?c.relogin(function(){b.reload()},a.redirectToLogin):0===d.status&&a.redirectOffline()})},g=function(e){d.screens.get({name:e},function(f){var g=f.content.collection[0].id;d.recomendations.get({screenId:g},function(b){switch(e){case"challengeNewPer":a.currencyRecomendations=b.content.collection;break;case"challengeNewLength":a.lengthRecomendations=b.content.collection;break;case"challengeNewPromise":a.promiseRecomendations=b.content.collection}},function(d){console.log("ERROR AL OBTENER FRECUENCIAS"),401===d.status?c.relogin(function(){b.reload()},a.redirectToLogin):0===d.status&&a.redirectOffline()})},function(d){console.log("ERROR AL OBTENER screenId --> challengeNewPer"),401===d.status?c.relogin(function(){b.reload()},a.redirectToLogin):0===d.status&&a.redirectOffline()})};a.checkTargetItem=function(b,c){a.newChallenge.customTarget&&(a.newChallenge.customTarget=!1,a.otherChallenge.text="");for(var d=0;d<a.targetRecomendations.length;d++)for(var e=0;e<a.targetRecomendations[d].items.length;e++)b===a.targetRecomendations[d].items[e].id?(a.targetRecomendations[d].items[e].checked=!0,a.newChallenge.target.name=a.targetRecomendations[d].items[e].name,a.newChallenge.target.text=a.targetRecomendations[d].items[e].description,a.newChallenge.categoryId=c.id):a.targetRecomendations[d].items[e].checked=!1},a.clearTargetCheckboxes=function(){for(var b=0;b<a.targetRecomendations.length;b++)for(var c=0;c<a.targetRecomendations[b].items.length;c++)a.targetRecomendations[b].items[c].checked=!1},a.selectCustomTarget=function(){a.newChallenge.customTarget||(a.clearTargetCheckboxes(),a.newChallenge.customTarget=!0,a.newChallenge.categoryId=null),a.newChallenge.target.name=a.newChallenge.target.text=a.otherChallenge.text},a.checkCurrencyItem=function(b){for(var c=0;c<a.currencyRecomendations.length;c++)b===a.currencyRecomendations[c].id?(a.currencyRecomendations[c].checked=!0,a.newChallenge.currency.name=a.currencyRecomendations[c].name,a.newChallenge.currency.text=a.currencyRecomendations[c].description,a.twentyOneEnabled="always"===a.newChallenge.currency.name?!0:!1):a.currencyRecomendations[c].checked=!1},a.checkLengthItem=function(b){for(var c=0;c<a.lengthRecomendations.length;c++)b===a.lengthRecomendations[c].id?(a.lengthRecomendations[c].checked=!0,a.newChallenge.timeLength.name=a.lengthRecomendations[c].name,a.newChallenge.timeLength.text=a.lengthRecomendations[c].description):a.lengthRecomendations[c].checked=!1},a.checkPromiseItem=function(b){a.newChallenge.customPromise&&(a.newChallenge.customPromise=!1,a.otherPromise.text="");for(var c=0;c<a.promiseRecomendations.length;c++)b===a.promiseRecomendations[c].id?(a.promiseRecomendations[c].checked=!0,a.newChallenge.promise.name=a.promiseRecomendations[c].name,a.newChallenge.promise.text=a.promiseRecomendations[c].description):a.promiseRecomendations[c].checked=!1},a.clearPromiseCheckboxes=function(){for(var b=0;b<a.promiseRecomendations.length;b++)a.promiseRecomendations[b].checked=!1},a.selectCustomPromise=function(){a.newChallenge.customPromise||(a.clearPromiseCheckboxes(),a.newChallenge.customPromise=!0),a.newChallenge.promise.name=a.otherPromise.text,a.newChallenge.promise.text=a.otherPromise.text},a.getScreenData("challengeNewTarget"),a.targetRecomendations=[],a.currencyRecomendations=[],a.lengthRecomendations=[],a.promiseRecomendations=[],a.otherChallenge={text:""},a.otherPromise={text:""},a.newChallenge={target:{name:"",text:""},currency:{name:"",text:""},timeLength:{name:"",text:""},promise:{name:"",text:""},customTarget:!1,customPromise:!1,challengeText:"",categoryId:null,create:function(){this.challengeText=this.promise.text+" zin egiten diot hurrengo erronka: |"+this.target.text+", "+this.currency.text.toLowerCase()+", "+this.timeLength.text.toLowerCase();var e=new Date;d.challenges.save({name:this.target.name+Date.parse(e),description:this.challengeText,promise:this.target.text,promisedTo:this.promise.name,objetive:this.timeLength.name,periodicity:this.currency.name,categoryId:this.categoryId},function(){a.contentManager.show(a.appMap.challenge)},function(d){console.log("ERROR CREATING CHALLENGE",d),401===d.status?c.relogin(function(){b.reload()},a.redirectToLogin):0===d.status&&a.redirectOffline()})}},a.getScreen(a.appMap.challengeNew.subviewActive,function(b){a.screen=b.content.collection[0],e(),g("challengeNewPer"),g("challengeNewLength"),g("challengeNewPromise")})}]),angular.module("appOhituApp").controller("ChallengeCtrl",["$scope","Utils","appMap","restclient","DateManager","$ionicModal","$route",function(a,b,c,d,e,f,g){f.fromTemplateUrl("my-modal.html",{scope:a,animation:"slide-in-up"}).then(function(b){a.modal=b}),a.openModal=function(){a.modal.show()},a.closeModal=function(){a.modal.hide()},a.$on("$destroy",function(){a.modal.remove()}),a.$on("modal.hidden",function(){}),a.$on("modal.removed",function(){});var h=function(c){a.challengeCollection=c.content.collection;for(var e=0;e<a.challengeCollection.length;e++){var f=a.challengeCollection[e],h=b.calcFinishDate(f.creationDate,f.objetive);moment().isAfter(h)&&!f.finished?d.challenges.update({id:f.id,finished:!0},function(){f.finished=!0,i(f)},function(c){console.log("ERROR MARCANDO COMO FINALIZADO"),401===c.status?b.relogin(function(){g.reload()},a.redirectToLogin):0===c.status&&a.redirectOffline()}):i(f)}},i=function(c){c.finished===!1&&null===a.challengesData.firstChallenge?(a.challengesData.firstChallenge=c,"string"==typeof a.challengesData.firstChallenge.description&&(a.challengesData.firstChallenge.description=b.splitBreakRow(a.challengesData.firstChallenge.description)),j(a.challengesData.firstChallenge)):c.finished===!1?(a.challengesData.activeChallenges.push(c),"string"==typeof a.challengesData.activeChallenges[a.challengesData.activeChallenges.length-1].description&&(a.challengesData.activeChallenges[a.challengesData.activeChallenges.length-1].description=b.splitBreakRow(a.challengesData.activeChallenges[a.challengesData.activeChallenges.length-1].description)),j(a.challengesData.activeChallenges[a.challengesData.activeChallenges.length-1])):(a.challengesData.inactiveChallenges.push(c),"string"==typeof a.challengesData.inactiveChallenges[a.challengesData.inactiveChallenges.length-1].description&&(a.challengesData.inactiveChallenges[a.challengesData.inactiveChallenges.length-1].description=b.splitBreakRow(a.challengesData.inactiveChallenges[a.challengesData.inactiveChallenges.length-1].description)),j(a.challengesData.inactiveChallenges[a.challengesData.inactiveChallenges.length-1]))},j=function(c){d.challengeregistry.get({challengeId:c.id},function(a){c.registry=a.content.collection,k(c)},function(c){console.log("ERROR OBTENIENDO CHALLENGE REGISTRY",c),401===c.status?b.relogin(function(){g.reload()},a.redirectToLogin):0===c.status&&a.redirectOffline()})},k=function(a){a.dateManager=new e(a),a.dateManager.attempsEnabled()};a.done=function(c){c.dateManager.attempsEnabled()>0&&!c.dateManager.todayDone()&&d.challengeregistry.save({challengeId:c.id},function(){j(c)},function(c){console.log("ERROR CREANDO REGISTRO DE RETO",c),401===c.status?b.relogin(function(){g.reload()},a.redirectToLogin):0===c.status&&a.redirectOffline()})},a.renew=function(c,e){var f=new Date,i=c.name.substring(0,c.name.length-13)+Date.parse(f);d.challenges.save({name:i,description:c.description[0]+"|"+c.description[1],promise:c.promise,promisedTo:c.promisedTo,objetive:c.objetive,periodicity:c.periodicity,categoryId:c.categoryId},function(){e&&a.change(a.appMap.challengeList),a.challengesData={firstChallenge:null,activeChallenges:[],inactiveChallenges:[]},a.getChallenges(h)},function(c){console.log("ERROR AL CREAR RENOVACIÓN DE RETO"),401===c.status?b.relogin(function(){g.reload()},a.redirectToLogin):0===c.status&&a.redirectOffline()})},a.deleteChallenge=function(e){d.challenges["delete"]({id:e},function(){a.closeModal(),a.changeToList(c.challengeList),a.challengesData={firstChallenge:null,activeChallenges:[],inactiveChallenges:[]},a.getChallenges(h)},function(c){console.log("ERROR BORRANDO RETOS",c),401===c.status?b.relogin(function(){g.reload()},a.redirectToLogin):0===c.status&&a.redirectOffline()})},a.changeToInner=function(b,c){a.randomTip={},a.innerChallenge=c,a.innerChallenge.dateManager=new e(a.innerChallenge),a.contentManager.change(b),a.getScreenData(b.subviewActive),m(c.categoryId)},a.changeToList=function(b){a.contentManager.change(b),a.getScreenData(b.subviewActive)};var l=function(c){d.categories.get({},c,function(c){console.log("ERROR OBTENIENDO CATEGORIA",c),401===c.status?b.relogin(function(){g.reload()},a.redirectToLogin):0===c.status&&a.redirectOffline()})},m=function(c){null!==c?a.getScreen("Tips",function(e){var f=e.content.collection[0];d.recomendations.get({screenId:f.id,categoryId:c},function(b){var c=b.content.collection;if(c.length>0){var d=Math.floor(Math.random()*(c.length-1+1));a.randomTip=c[d],l(function(b){for(var c=b.content.collection,d=0;d<c.length;d++)if(c[d].id===a.randomTip.categoryId){a.randomTip.categoryName=c[d].name;break}})}else n()},function(c){console.log("ERROR AL OBTENER RECOMENDACIONES",c),401===c.status?b.relogin(function(){g.reload()},a.redirectToLogin):0===c.status&&a.redirectOffline()})}):n()},n=function(){l(function(c){for(var e=c.content.collection,f={},h=0;h<e.length;h++)if("Ohitu"===e[h].name){f=e[h];break}d.recomendations.get({categoryId:f.id},function(b){var c=b.content.collection;if(c.length>0){var d=Math.floor(Math.random()*(c.length-1+1));a.randomTip=c[d],a.randomTip.categoryName=f.name}},function(c){console.log("ERROR AL OBTENER RECOMENDACIONES",c),401===c.status?b.relogin(function(){g.reload()},a.redirectToLogin):0===c.status&&a.redirectOffline()})})};a.getScreenData(a.contentManager.subviewActive),a.challengesData={firstChallenge:null,activeChallenges:[],inactiveChallenges:[]},a.getChallenges(h)}]),angular.module("appOhituApp").service("menuData",function(){return{items:[{name:"Erronken zerrenda",active:"active",key:"challengeList",url:"views/challengeList.html"},{name:"Erronka gehitu",active:"",key:"challengeNew",url:"views/challengeNew.html"},{name:"Profila",active:""},{name:"Oharrak",active:""},{name:"Gure buruz",active:""}]}}),angular.module("appOhituApp").service("appMap",function(){return{login:{key:"login",url:"views/login.html",subviewActive:"start"},start:{subviewActive:"start"},"new":{subviewActive:"new"},enter:{subviewActive:"enter"},forgot:{subviewActive:"forgot"},emailSent:{subviewActive:"emailSent"},firstUseSlider:{key:"firstUseSlider",url:"views/firstUseSlider.html",title:"",menu:!1,bar:!1,backButton:!1,backButtonSubView:""},challenge:{key:"challenge",url:"views/challenge.html",title:"Erronken zerrenda",menu:!0,bar:!0,backButton:!1,subviewActive:"challengeList"},challengeList:{subviewActive:"challengeList",menu:!0,bar:!0,backButton:!1},challengeInner:{subviewActive:"challengeInner",menu:!0,bar:!0,backButton:!0,backButtonSubView:"challengeList"},challengeInnerEnd:{subviewActive:"challengeInnerEnd",menu:!0,bar:!0,backButton:!0,backButtonSubView:"challengeList"},challengeNew:{key:"challengeNew",title:"Erronka gehitu",url:"views/challengeNew.html",menu:!0,bar:!0,backButton:!1,backButtonSubView:"",subviewActive:"challengeNewTarget"},challengeNewTarget:{subviewActive:"challengeNewTarget",menu:!0,bar:!0,backButton:!1},challengeNewPer:{subviewActive:"challengeNewPer",menu:!0,bar:!0,backButton:!0,backButtonSubView:"challengeNewTarget"},challengeNewLength:{subviewActive:"challengeNewLength",menu:!0,bar:!0,backButton:!0,backButtonSubView:"challengeNewPer"},challengeNewPromise:{subviewActive:"challengeNewPromise",menu:!0,bar:!0,backButton:!0,backButtonSubView:"challengeNewLength"},about:{key:"about",url:"views/about.html",title:"Gure buruz",bar:!0,menu:!0},tips:{key:"tips",url:"views/tips.html",title:"Gomendioak",bar:!0,menu:!0},profile:{key:"profile",url:"views/profile.html",title:"Profila",bar:!0,menu:!0,subviewActive:"profileData"},profileData:{subviewActive:"profileData",menu:!0,bar:!0,backButton:!1},changeEmail:{subviewActive:"changeEmail",menu:!1,bar:!0,backButton:!0,backButtonSubView:"profileData"},changePassword:{subviewActive:"changePassword",menu:!1,bar:!0,backButton:!0,backButtonSubView:"profileData"}}}),angular.module("appOhituApp").service("Utils",["restclient",function(a){this.getContentManager=function(a){var b={key:a.key,url:a.url,title:a.title,menu:a.menu,bar:a.bar,backButton:a.backButton,backButtonSubView:a.backButtonSubView,subviewActive:a.subviewActive,show:function(a){this.key=void 0===a.key?"":a.key,this.url=void 0===a.url?"":a.url,this.title=void 0===a.title?"":a.title,this.menu=void 0===a.menu?"":a.menu,this.bar=void 0===a.bar?"":a.bar,this.backButton=void 0===a.backButton?"":a.backButton,this.backButtonSubView=void 0===a.backButtonSubView?"":a.backButtonSubView,this.subviewActive=void 0===a.subviewActive?"":a.subviewActive,this.mainMenu.close()},change:function(a){this.title=void 0===a.title?"":a.title,this.menu=void 0===a.menu?"":a.menu,this.bar=void 0===a.bar?"":a.bar,this.subviewActive=void 0===a.subviewActive?"":a.subviewActive,this.backButton=void 0===a.backButton?"":a.backButton,this.backButtonSubView=void 0===a.backButtonSubView?"":a.backButtonSubView},mainMenu:{isOpen:!1,menuClass:"",toggle:function(){this.isOpen?this.close():this.open()},close:function(){this.menuClass="",this.isOpen=!1},open:function(){this.menuClass="opened",this.isOpen=!0}}};return b},this.getFirstByName=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return a[c]},this.getFirstById=function(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return a[c]},this.getMenuManager=function(){var a={active:"",toggle:function(){this.active=""===this.active?"active":""}};return a},this.getScreenData=function(b){var c={};a.screens.get({name:b},function(a){c=a.content.collection[0]})},this.getCookie=function(a){var b="; "+document.cookie,c=b.split("; "+a+"=");return 2===c.length?c.pop().split(";").shift():void 0},this.setCookie=function(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString();document.cookie=a+"="+b+"; "+e},this.deleteCookie=function(a){document.cookie=a+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},this.splitBreakRow=function(a){return a.split("|")},this.calcFinishDate=function(a,b){var c={},d=moment(a,"DD/MM/YYYY hh:mm:ss").toDate();if(d=moment(d),-1!==b.indexOf("length_month_")){var e=parseInt(b.replace("length_month_",""));c=d.add(e,"month")}else"length_week"===b?c=d.add(1,"week"):"length_year"===b?c=d.add(1,"year"):"21"===b&&(c=d.add(21,"days"));return c},this.createSession=function(a){localStorage.setItem("userId",a.id),localStorage.setItem("token",a.token)},this.deleteSession=function(){localStorage.removeItem("userId"),localStorage.removeItem("token")},this.sessionExist=function(){var a=!1;return null!==localStorage.getItem("userId")&&null!==localStorage.getItem("token")&&(a=!0),a},this.relogin=function(b,c){a.relogin.save({userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},b,c)}}]),angular.module("appOhituApp").factory("restclient",["$resource",function(a){var b="http://api.ohitu.es/api";return{login:a(b+"/login",{},{}),users:a(b+"/users",{},{update:{method:"PUT"}}),categories:a(b+"/categories",{},{}),challenges:a(b+"/challenges",{},{update:{method:"PUT"}}),screens:a(b+"/screens",{},{}),literals:a(b+"/literals",{},{}),recomendations:a(b+"/recomendations",{},{}),challengeregistry:a(b+"/challengeregistry",{},{}),relogin:a(b+"/relogin",{},{}),resetpassword:a(b+"/resetpassword",{},{send:{method:"PUT"}})}}]),angular.module("appOhituApp").factory("DateManager",function(){function a(a){this.startDate=moment(a.creationDate,"DD/MM/YYYY hh:mm:ss"),this.startDateString=this.startDate.format("DD/MM/YYYY"),this.startDayOfTheWeek=this.startDate.day(),this.objetive=a.objetive,this.periodicity=a.periodicity,this.finishDate=this.calcFinishDate(),this.finishDateString=this.calcFinishDate().format("DD/MM/YYYY"),this.registry=a.registry,this.weeksAttempsLeft=this.attempsEnabled(),this.totalAttemps=b(this.startDate,this.finishDate,c(this.periodicity)),this.currentAttemps=this.registry.length,this.howMuchDone=this.howMuchDone(),this.howMuchDoneExact=this.howMuchDoneExact(),this.startDay=this.startDate.day()}a.prototype.calcFinishDate=function(){var a={},b=this.startDate.toDate();if(b=moment(b),-1!==this.objetive.indexOf("length_month_")){var c=parseInt(this.objetive.replace("length_month_",""));a=b.add(c,"month")}else"length_week"===this.objetive?a=b.add(1,"week"):"length_year"===this.objetive?a=b.add(1,"year"):"21"===this.objetive&&(a=b.add(21,"days"));return a},a.prototype.howMuchDone=function(){var a=0,d=this.registry.length;if(d>0){var e=c(this.periodicity),f=b(this.startDate,this.finishDate,e);a=100*d/f}return Math.round(a)},a.prototype.howMuchDoneExact=function(){var a=0,d=this.registry.length;if(d>0){var e=c(this.periodicity),f=b(this.startDate,this.finishDate,e);a=100*d/f}return a.toFixed(2)},a.prototype.attempsEnabled=function(){var a,b,d=0,e=0,f=c(this.periodicity);moment().day()>this.startDate.day()?d=moment().day()-this.startDate.day():moment().day()<this.startDate.day()&&(d=Math.abs(this.startDate.day()-moment().day()-7)),a=moment().subtract(d+1,"days").endOf("day"),b=moment().subtract(d,"days").add(7,"days").startOf("day");for(var g=0;g<this.registry.length;g++)moment(this.registry[g].date,"DD/MM/YYYY hh:mm:ss").isBetween(a,b)&&e++;return f-e},a.prototype.todayDone=function(){for(var a=!1,b=0;b<this.registry.length;b++)if(moment(this.registry[b].date,"DD/MM/YYYY hh:mm:ss").isBetween(moment().subtract(1,"day").endOf("day"),moment().add(1,"day").startOf("day"))){a=!0;break}return a};var b=function(a,b,c){var d=b.diff(a,"weeks");return c*d},c=function(a){var b;return b="always"===a?7:parseInt(a.replace("week_",""))};return a}),angular.module("appOhituApp").controller("AboutCtrl",["$scope",function(){}]),angular.module("appOhituApp").controller("ProfileCtrl",["$scope","restclient","$ionicModal","$route","Utils",function(a,b,c,d,e){c.fromTemplateUrl("my-modal.html",{scope:a,animation:"slide-in-up"}).then(function(b){a.modal=b}),a.openModal=function(){a.modal.show()},a.closeModal=function(){a.modal.hide()},a.$on("$destroy",function(){a.modal.remove()}),a.$on("modal.hidden",function(){}),a.$on("modal.removed",function(){}),a.change=function(b){a.contentManager.change(b),a.getScreenData(b.subviewActive)},a.getUserData=function(){b.users.get({},function(b){a.userData=b.content.item},function(b){console.log("ERROR AL OBTENER DATOS DE USUARIO",b),401===b.status?e.relogin(function(){d.reload()},a.redirectToLogin):0===b.status&&a.redirectOffline()})},a.emailChanger={email:"",validationMessage:"",change:function(){var c=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;c.test(this.email)?b.users.update({email:this.email},function(){a.change(a.appMap.profileData),a.getUserData(),a.emailChanger.email=""},function(b){console.log("ERROR AL CAMBIAR EMAIL",b),401===b.status?e.relogin(function(){d.reload()},a.redirectToLogin):0===b.status?a.redirectOffline():a.emailChanger.validationMessage=a.literals.server_error.literal}):this.validationMessage=a.literals.wrong_mail_error.literal}},a.passChanger={pass:"",passrpt:"",validationMessage:"",change:function(){""!==this.pass&&""!==this.passrpt?this.pass===this.passrpt?this.pass.length>3?b.users.update({password:this.pass},function(){a.change(a.appMap.profileData),a.getUserData(),a.passChanger.pass="",a.passChanger.passrpt=""},function(b){console.log("ERROR AL CAMBIAR CONTRASEÑA",b),401===b.status?e.relogin(function(){d.reload()},a.redirectToLogin):0===b.status?a.redirectOffline():a.emailChanger.validationMessage=b.data.content.message}):this.validationMessage=a.literals.length_pass_error.literal:this.validationMessage=a.literals.equals_pass_error.literal:this.validationMessage=a.literals.empty_pass_error.literal}},a.deleteUser={"do":function(){b.users["delete"]({},function(){e.deleteSession(),d.reload()},function(a){console.log("ERROR AL BORRAR USUARIO",a)})},openConfirmation:function(){a.openModal()},closeConfirmation:function(){a.closeModal()}},a.getScreenData(a.contentManager.subviewActive),a.getUserData()}]),angular.module("appOhituApp").controller("TipsCtrl",["$scope","restclient","Utils","$route",function(a,b,c,d){var e=function(e){var g=e.content.collection[0].id;b.recomendations.get({screenId:g},function(a){var b=a.content.collection;b=b.sort(function(){return Math.random()-.5});for(var c=0;c<b.length;c++)f(b[c])},function(b){console.log("ERROR OBTENIENDO TIPS",b),401===b.status?c.relogin(function(){d.reload()},a.redirectToLogin):0===b.status&&a.redirectOffline()})},f=function(e){b.categories.get({},function(b){var c={};c.description=e.description,c.category="Sin categoria";for(var d=b.content.collection,f=0;f<d.length;f++)if(d[f].id===e.categoryId){c.category=d[f].name;break}a.tips.push(c)},function(b){console.log("ERROR OBTENIENDO CATEGORIAS",b),401===b.status?c.relogin(function(){d.reload()},a.redirectToLogin):0===b.status&&a.redirectOffline()})};a.getScreenData(a.contentManager.key),a.tips=[],a.getScreen(a.contentManager.key,e)}]),angular.module("appOhituApp").controller("firstUseSlider",["$scope",function(a){a.getScreenData(a.contentManager.key)}]),angular.module("appOhituApp").service("fixedLiterals",function(){return{eu:{challengeList:"Erronken zerrenda",challengeInner:"Nire erronka",challengeInnerEnd:"Nire amaitutako erronka",challengeNewTarget:"Erronka gehitu",challengeNewPer:"Erronka gehitu",challengeNewLength:"Erronka gehitu",challengeNewPromise:"Erronka gehitu",about:"Gure buruz",tips:"Gomendioak",profile:"Nire profila",enter:"Sartu",newUser:"Erabiltzaile berria",userOrEmail:"Erabiltzaile edo email-a",offline:"Ohitu erabiltzeko sarera konektatu egin behar zara. Konprobatu zure konexioa",password:"Pasahitza",back:"Atzera",forgotClaim:"Pasahitza ahaztu zaizu?",retry:"Berriz saiatu",newUserTitle:"Erabiltzaile berria",email:"Posta elektronikoa",user:"Erabiltzailea",rptPassword:"Pasahitza errepikatu",create:"Sortu",forgotTitle:"Pasahitza ahaztu duzu?",forgotSubtitle:"Baliozko posta elektronikoa bidali ezkero, bertan izango duzu zure pasahitz berria.",send:"Bidali",emailSentDesc:"Email bat bidali dizugu zure pasahitz berriarekin. Ez baduzu aurkitzen begira ezazu spam direktorioan.","return":"Bueltatu",chListSubtitle:"Gaurko erronka bete duzu?",chListCheck:"Markatu eta jarraitu.",chListLastTitle:"Zure azkenaldiko abentura",weekSuccess:"Ederki, aste honetan helburua bete duzu!",progressPre:"Erronkaren %",progressPost:" bete duzu.",otherChallengesTitle:"Zure erronka aktiboen artean",otherChallengesEmpty:"Ez daukazu erronka gehiagorik",endedChallengesTitle:"Bukaturiko erronkak",renewChallenge:"Erronka berritu",finishedChallengesEmpty:"Ez daukazu bukaturiko erronkarik",challengesEmpty:"Ez daukazu erronkarik",weeksLeft:"Aste honetan falta zaizkizu: ",creationDate:"Sortze data: ",finishDate:"Bukatze epea: ",triesDone:"Egindako errepikapenak: ",deleteChallenge:"Erronka ezabatu",deleteChallengeConfirm:"Zihur zaude erronka ezabatu nahi duzula?",yes:"Bai",no:"Ez",challengeTargetSubtitle:"Zer lortu nahi duzu?",chooseOther:"Beste bat aukeratu: ",next:"Hurrengoa",writeHere:"Idatzi hemen",challengePerSubtitle:"Zer maiztasunarekin?",challengeLengthSubtitle:"Noiz arte?",challengePromiseSubtitle:"Nori zin egiten diozu?",save:"Gorde",profileSubtitle:"Zure datu pertsonalak",changePassword:"Nire pasahitza aldatu nahi dut",logout:"Saioa itxi",deleteUser:"Erabiltzailea ezabatu",confirmDeleteUser:"Zihur zaude erabiltzailea ezabatu nahi duzula?",changePasswordLabel:"Idatzi pasahitz berria",changePasswordLabelRpt:"Errepikatu pasahitza",emailLabel:"Zure email berria",p1:"Aldatu zure ohiturak eta superhuman bat bilakatu!",p2:"Ohitu animatu egiten zaitu baikortasunarekin, helburua lor dezazun.",p3:"Aukeratu 20 erronka baino gehiagoren artetik bat edo zeure gustuko erronka sortu.",tip1:"Eskailerak igo.",tip2:"Hizkuntzak ikasi.",tip3:"Ura edan...",inst_title:"HORRELA ERABILTZEN DA OHITU",inst1:"Aukeratu zure erronka",inst1_1:"Sortu erronka pertsonala edo aukera ezazu aplikazioa eskaintzen dizun 20 ohitura baino gehiagoren artean, adibidez, eskailerak igo, ez erre, ur gehiago edan, irakurri, hizkuntza berria ikasi...  ",inst1_2:"Helburu bat baino gehiago izan ahal duzu, zuk aukeratu!",inst1_3:"Ohitu, helmuga bistaratu eta helburua burutik ez galtzera laguntzen zaitu.",inst2_title:"Aukera ezazu erronkaren maiztasun eta luzeera.",inst2_1:"Dagoeneko badaukazu helmuga markatuta, aukera ezazu maiztasuna eta helburua betetzeko izango duzun denbora. Eguneko ohitura betetzean, marka ezazu. Konturatu barik azkeneko helburua lortuko duzu.",inst3_title:"Zin egin ezazu nahi duzun pertsonari.",inst3_1:"Zure kirikiñoari, bikoteari, amari edo zure buruari. Zin egin eta bete!",inst3_2:"Abentura hasteko momentua heldu da. Bakarrik 21 egun behar dira Superhuman bat bihurtzeko.",worko1:"Worköholicsen gozatu dugu Ohitu sortzen. Primerakoa izango litzateke idaztea hello@workoholics.es helbidera, erronkak betetzeko trukuak proposatzeko eta erabiltzaile guztien artean elkarbanatzeko.",menuChallengeList:"Erronken zerrenda",menuChallengeNew:"Erronka gehitu",menuAbout:"Gure buruz",menuTips:"Gomendioak",menuProfile:"Nire profila",menuLogout:"Saioa itxi",day1:"Astelehena",day2:"Asteartea",day3:"Asteazkena",day4:"Osteguna",day5:"Ostirala",day6:"Larunbata",day7:"Igandea",startDayLabel:"Sortze eguna: ",firstUse1:"Abentura handi bat hastear zaude.",firstUse2:"Zure erronka aukeratu.",firstUse2_1:"Hobeto elikatu? Zure gorputzari mugimendua eman?",firstUse3:"Euki helburua zure buruan.",firstUse3_1:"Bakarrik 21 egun behar dira Superhuman bat bihurtzeko.",firstUse4:"Motibazioa mantendu.",firstUse4_1:"Nori zin egiten diozu erronka?",start:"Hasi"},es:{challengeList:"Listado de retos",challengeInner:"Nire erronka",challengeInnerEnd:"Mi reto finalizado",challengeNewTarget:"Añadir reto",challengeNewPer:"Añadir reto",challengeNewLength:"Añadir reto",challengeNewPromise:"Añadir reto",tips:"Consejos",profile:"Perfil",about:"Sobre nosotros",enter:"Entrar",newUser:"Nuevo usuario",userOrEmail:"Usuario o email",password:"Contraseña",back:"Atras",forgotClaim:"¿Se te ha olvidado la contraseña?",offline:"Para utilizar Ohitu necesitas estar conectado a la red. Comprueba tu conexión",retry:"Volver a intentar",newUserTitle:"Nuevo usuario",email:"Email",user:"Usuario",rptPassword:"Repite la contraseña",create:"Crear",forgotTitle:"¿Has olvidado tu contraseña?",forgotSubtitle:"Introduciendo un mail válido te enviaremos una nueva contraseña.",send:"Enviar",emailSentDesc:"Te hemos enviado un mail con tu nueva contraseña. En caso de no encontrarlo en tu bandeja de entrada, comprueba el spam.","return":"Volver",chListSubtitle:"¿Has cumplido el reto de hoy?",chListCheck:"Márcalo en el checkbox y sigue adelante.",chListLastTitle:"Tu última aventura",weekSuccess:"¡Genial, esta semana ya has cumplido!",progressPre:"Has completado el ",progressPost:"% de las veces.",otherChallengesTitle:"Entre tus retos activos",otherChallengesEmpty:"No tienes más retos activos",endedChallengesTitle:"Retos terminados",renewChallenge:"Renovar reto",finishedChallengesEmpty:"No tienes retos terminados",challengesEmpty:"No tienes retos",weeksLeft:"Esta semana te faltan: ",creationDate:"Fecha de creación: ",finishDate:"Fecha fin: ",triesDone:"Repeticiones realizadas: ",deleteChallenge:"Borrar reto",deleteChallengeConfirm:"¿Estas seguro de que quieres borrar el reto?",yes:"Si",no:"No",challengeTargetSubtitle:"¿Que quieres conseguir?",chooseOther:"Elegir personalizado: ",next:"Siguiente",writeHere:"Escribe aquí",challengePerSubtitle:"¿Con cuanta frecuencia?",challengeLengthSubtitle:"¿Hasta cuando?",challengePromiseSubtitle:"¿Nori zin egiten diozu?",save:"Guardar",profileSubtitle:"Tus datos personales",changePassword:"Quiero cambiar mi contraseña",logout:"Cerrar sesión",deleteUser:"Borrar usuario",confirmDeleteUser:"¿Estas seguro que quieres borrar el usuario?",changePasswordLabel:"Introduze tu nueva contraseña",changePasswordLabelRpt:"Repite la contraseña",emailLabel:"Tu nuevo email",p1:"¡Cambia tus hábitos y conviértete en un Superhuman!",p2:"Ohitu te anima a conseguirlo con optimismo.",p3:"Escoge entre más de 20 retos diferentes, o crea el tuyo propio.",tip1:"Sube escaleras.",tip2:"Aprende idiomas.",tip3:"Bebe agua...",inst_title:"HORRELA ERABILTZEN DA OHITU",inst1:"Elige tu meta, visualiza tu objetivo",inst1_1:"Crea tu propio objetivo o escoge entre los mas de 20 propósitos a cumplir que la app te ofrece, entre los que se encuentra subir las escaleras, no fumar, beber más agua, leer, aprender un idioma...",inst1_2:"Puedes marcarte uno o varios objetivos ¡tú eliges!",inst1_3:"Ohitu te ayuda a visualizar la meta y no perder de tu mente los objetivos.",inst2_title:"Escoge la frecuencia y duración del reto.",inst2_1:"Ya tienes tu meta marcad, escoge la frecuencia con la que vayas a cumplirla y hasta cuando quieres continuar haciendo el reto. Cuando hayas cumplido el reto, marca tu checkpoint y guarda el registro en la app. Sin darte cuenta conseguirás el objetivo final.",inst3_title:"Prométeselo a quien quieras.",inst3_1:"A tu erizo, a tu pareja, a tu madre o a ti mismo. ¡Promételo y cumple!",inst3_2:"A un toque de comenzar una nueva aventura. Sólo hacen falta 21 días para convertirte en un héroe.",worko1:"En Worköholics hemos disfrutado creando Ohitu. Sería genial que nos escribieras a hello@workoholics.es para aportar tus trucos para conseguir retos y compartirlos con todos los usuarios.",menuChallengeList:"Listado de retos",menuChallengeNew:"Añadir reto",menuAbout:"Sobre nosotros",menuTips:"Consejos",menuProfile:"Perfil",menuLogout:"Cerrar sesión",day1:"Lunes",day2:"Martes",day3:"Miércoles",day4:"Jueves",day5:"Viernes",day6:"Sábado",day7:"Domingo",startDayLabel:"Día de creación",firstUse1:"Estas a punto de empezar una gran aventura.",firstUse2:"Escoge tu reto.",firstUse2_1:"Alimentarte mejor? Darle un poco de movimiento al cuerpo?",firstUse3:"Ten el objetivo en tu cabeza.",firstUse3_1:"Solo hacen falta 21 días para convertirte en un superhuman.",firstUse4:"Mantén la motivación.",firstUse4_1:"A quién se lo prometes?",start:"Empezar"}}
});